{% extends 'base.html.twig' %}

{% block title %}
    {{ event.name }}
{% endblock %}

{% block body %}
   <header class="main_menu home_menu">
      <div class="container">
          <div class="row align-items-center">
              <div class="col-lg-12">
                  <nav class="navbar navbar-expand-lg navbar-light">
                      <a class="navbar-brand" href="index.html"> <img src="img/logo.png" alt="logo"> </a>
                      <button class="navbar-toggler" type="button" data-toggle="collapse"
                          data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                          aria-expanded="false" aria-label="Toggle navigation">
                          <span class="menu_icon"><i class="fas fa-bars"></i></span>
                      </button>

                      <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                          <ul class="navbar-nav">
                              <li class="nav-item">
                                  <a class="nav-link" href="index.html">Home</a>
                              </li>
                              <li class="nav-item dropdown">
                                  <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_1"
                                      role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      Shop
                                  </a>
                                  <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                      <a class="dropdown-item" href="category.html"> shop category</a>
                                      <a class="dropdown-item" href="single-product.html">product details</a>
                                      
                                  </div>
                              </li>
                              <li class="nav-item dropdown">
                                  <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_3"
                                      role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      pages
                                  </a>
                                  <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                      <a class="dropdown-item" href="login.html"> login</a>
                                      <a class="dropdown-item" href="tracking.html">tracking</a>
                                      <a class="dropdown-item" href="checkout.html">product checkout</a>
                                      <a class="dropdown-item" href="cart.html">shopping cart</a>
                                      <a class="dropdown-item" href="confirmation.html">confirmation</a>
                                      <a class="dropdown-item" href="elements.html">elements</a>
                                  </div>
                              </li>
                              <li class="nav-item dropdown">
                                  <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_2"
                                      role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                      blog
                                  </a>
                                  <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                      <a class="dropdown-item" href="blog.html"> blog</a>
                                      <a class="dropdown-item" href="single-blog.html">Single blog</a>
                                  </div>
                              </li>
                              
                              <li class="nav-item">
                                  <a class="nav-link" href="contact.html">Contact</a>
                              </li>
                          </ul>
                      </div>
                      <div class="hearer_icon d-flex">
                          <a id="search_1" href="javascript:void(0)"><i class="ti-search"></i></a>
                          <a href=""><i class="ti-heart"></i></a>
                          <div class="dropdown cart">
                              <a class="dropdown-toggle" href="#" id="navbarDropdown3" role="button"
                                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  <i class="fas fa-cart-plus"></i>
                              </a>
                               <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                  <div class="single_product">
  
                                  </div>
                              </div>
                              
                          </div>
                      </div>
                  </nav>
              </div>
          </div>
      </div>
     
  </header>


  <section class="breadcrumb breadcrumb_bg">
      <div class="container">
         <div class="row justify-content-center">
            <div class="col-lg-8">
               <div class="breadcrumb_iner">
                  <div class="breadcrumb_iner_item">
                     <h2>Show event details</h2>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </section>
   <!-- breadcrumb start-->
   <!--================Blog Area =================-->
   <section class="blog_area single-post-area padding_top">
      <div class="container">
         <div class="row">
            <div class="col-lg-8 posts-list">
               <div class="single-post">
                  <div class="feature-img">
   <div id="carousel{{ event.id }}" class="carousel slide" data-ride="carousel">
            <div class="carousel-inner">
                {% for image in event.images %}
                    <div class="carousel-item{% if loop.first %} active{% endif %}">
<img class="d-block w-100" src="{{ asset(image.imageName) }}" alt="Event Image">
                    </div>
                {% endfor %}
            </div>
            <a class="carousel-control-prev" href="#carousel{{ event.id }}" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carousel{{ event.id }}" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
        </div>
        


        
                          </div>
                  <div class="blog_details">
                     <h2>                  {{ event.name }}
                     </h2>
                     <ul class="blog-info-link mt-3 mb-4">
                        <li><a href="#"><i class="far fa-user"></i> </a></li>
                        <li><a href="#"><i class="far fa-comments"></i>     {{ event.location }}</a></li>
                     </ul>
                     <p class="excert">
                         {{ event.description }}
                     </p>
                
                  </div>
               </div>
               <div class="navigation-top">
                  <div class="d-sm-flex justify-content-between text-center">
  <p class="like-info">
  <span class="align-middle" id="like-{{ event.id }}">
    <i class="far fa-heart"></i>
  </span>
  {% if event.likeCount > 0 %}
    <span class="like-count">
      {% for like in event.likes %}
        {% if loop.index == 1 %}
          {{ like.username }} and {{ event.likeCount - 1 }} others like this
        {% endif %}
      {% endfor %}
    </span>
  {% else %}
    <span class="like-count">0 likes</span>
  {% endif %}
</p>

<script>
function likeEvent(event) {
  const eventId = event.target.getAttribute('data-event-id');
  fetch('/like/' + eventId, {
    method: 'POST',
    credentials: 'same-origin'
  })
  .then(response => {
    if (response.ok) {
      // Update the heart icon and like count
      const likeButton = event.target;
      const heartIcon = likeButton.closest('.like-info').querySelector('i');
      likeButton.classList.toggle('liked');

      if (likeButton.classList.contains('liked')) {
        heartIcon.classList.remove('far');
        heartIcon.classList.add('fas');
      } else {
        heartIcon.classList.remove('fas');
        heartIcon.classList.add('far');
      }

      const likeCount = parseInt(likeButton.nextElementSibling.textContent);
      likeButton.nextElementSibling.textContent = likeCount + (likeButton.classList.contains('liked') ? 1 : -1);
    } else {
      // Handle error
      console.error('Error liking event:', response.statusText);
    }
  })
  .catch(error => {
    // Handle network error
    console.error('Network error:', error);
  });
}

// ...

document.addEventListener('DOMContentLoaded', () => {
  const heartIcons = document.querySelectorAll('.far.fa-heart');
  heartIcons.forEach((icon) => {
    // Check if the current user has liked the event
    const eventId = icon.closest('.like-info').querySelector('span').getAttribute('id').replace('like-', '');
    fetch('/check-like/' + eventId, {
      method: 'GET',
      credentials: 'same-origin'
    })
    .then(response => {
      if (response.ok) {
        response.json().then(data => {
          if (data.liked) {
            icon.classList.add('liked');
            icon.classList.remove('far');
            icon.classList.add('fas');
          }
        });
      }
    });

    icon.setAttribute('data-event-id', icon.closest('.like-info').querySelector('span').getAttribute('id').replace('like-', ''));
    icon.addEventListener('click', likeEvent);
  });

  // Add this code
  const likeInfoElements = document.querySelectorAll('.like-info');
  likeInfoElements.forEach((likeInfo) => {
    const eventId = likeInfo.querySelector('span').getAttribute('id').replace('like-', '');
    const likeCountElement = likeInfo.querySelector('.like-count');

    // Function to update the likes text
    const updateLikesText = () => {
      fetch(`/likes-count/${eventId}`, {
        method: 'GET',
        credentials: 'same-origin'
      })
      .then(response => {
        if (response.ok) {
          response.json().then(data => {
            const likeCount = data.likeCount;
            let likesText = '';

            if (likeCount > 0) {
              likesText = `${data.firstLikeUsername} and ${likeCount - 1} others like this`;
            } else {
              likesText = `0 people like this`;
            }

            likeCountElement.textContent = likesText;
          });
        }
      });
    };

    // Call the updateLikesText function initially
    updateLikesText();

    // Listen for changes in the like count
    const likeButtons = likeInfo.querySelectorAll('.far.fa-heart');
    likeButtons.forEach((likeButton) => {
      likeButton.addEventListener('click', () => {
        updateLikesText();
      });
    });
  });
});
</script>

<style>
.like-info i.fa-heart.liked {
  color: red;
}


.like-info i.fa-heart {
  transition: transform 0.3s;
}

.like-info i.fa-heart.liked {
  color: red;
}

.like-info i.fa-heart:active {
  animation: heartbeat 0.5s ease-in-out;
}

@keyframes heartbeat {
  0% {
    transform: scale(1);
  }
  25% {
    transform: scale(1.1);
  }
  50% {
    transform: scale(1);
  }
  75% {
    transform: scale(1.1);
  }
  100% {
    transform: scale(1);
  }
}
</style>
                     <div class="col-sm-4 text-center my-2 my-sm-0">
                        <!-- <p class="comment-count"><span class="align-middle"><i class="far fa-comment"></i></span> 06 Comments</p> -->
                     </div>
                     <ul class="social-icons" style="display: flex; flex-direction: row;">
  <li><strong>Max Attendees:</strong> {{ event.maxAttendees }}</li>
  <li><strong>Participants:</strong> {{ event.participantCount }}</li>
  <li><strong>Rating:</strong> {{ event.ratingAverage }}</li>
</ul>
                  </div>
                  <div class="navigation-area">
                     <div class="row">
                        <div
                           class="col-lg-6 col-md-6 col-12 nav-left flex-row d-flex justify-content-start align-items-center">
                           <div class="thumb">
                              <a href="#">
                                 <img class="img-fluid" src="img/post/preview.png" alt="">
                              </a>
                           </div>
                           <div class="arrow">
                              <a href="#">
                                 <span class="lnr text-white ti-arrow-left"></span>
                              </a>
                           </div>
                           <div class="detials">
                              <p>Start Date</p>
                              <a href="#">
                                 <h4> {{ event.startDate|date('Y-m-d H:i') }}</h4>
                              </a>
                           </div>
                        </div>
                        <div
                           class="col-lg-6 col-md-6 col-12 nav-right flex-row d-flex justify-content-end align-items-center">
                           <div class="detials">
                              <p>End Date</p>
                              <a href="#">
                                 <h4> {{ event.endDate|date('Y-m-d H:i') }}</h4>
                              </a>
                           </div>
                           <div class="arrow">
                              <a href="#">
                                 <span class="lnr text-white ti-arrow-right"></span>
                              </a>
                           </div>
                           <div class="thumb">
                              <a href="#">
                                 <img class="img-fluid" src="img/post/next.png" alt="">
                              </a>
                           </div>
                        </div>
                     </div>
                  </div>
               </div>
               
               <div class="comments-area">
                    <h4>{{ commentCount }} Comments</h4>
                
            
                  <div class="comment-list">
                               {% for comment in comments %}
  <div class="single-comment justify-content-between d-flex">
    <div class="user justify-content-between d-flex">
      <div class="thumb">
        <img src="img/comment/comment_3.png" alt="">
      </div>
      <div class="desc">
        <p class="comment">{{ comment.content }}</p>
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center">
            <h5><a href="#">{{ comment.user.firstName }}</a></h5>
            <p class="date">{{ comment.createdAt|date('m/d/Y h:i A') }}</p>
          </div>
          <div class="reply-btn">
            <a href="#" class="btn-reply text-uppercase">Reply</a>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endfor %}
                  </div>
               </div>
             <div class="comment-form">
    <h4>Leave a Reply</h4>
    {{ form_start(form) }}
    <div class="row">
        <div class="col-12">
            <div class="form-group">
                {{ form_widget(form.content, {'attr': {'class': 'form-control', 'cols': '30', 'rows': '9', 'placeholder': 'Write Comment'}}) }}
            </div>
        </div>
    </div>
    <div class="form-group mt-3">
        <button type="submit" class="btn_3 button-contactForm">Comment</button>
    </div>
    {{ form_end(form) }}
</div>

            </div>
            <div class="col-lg-4">
               <div class="blog_right_sidebar">
                  <aside class="single_sidebar_widget search_widget">
                     <form action="#">
                        <div class="form-group">
                           
                        </div>


{% if app.user and app.user.userId == event.organizer.userId %}
    <a class="button rounded-0 primary-bg text-white w-100 btn_1" href="{{ path('event_edit', {'id': event.id}) }}" style="text-align: center; color: white !important; display: block;">
        Edit Event
    </a>

    <a class="button rounded-0 primary-bg text-white w-100 btn_1" href="{{ path('event_delete', {'id': event.id}) }}" onclick="return confirm('Are you sure you want to delete this event?')" style="text-align: center; color: white !important; display: block;">
        Delete
    </a>
{% endif %}

                        
                        
                                             </form>






                                             
{% if app.user %}
  {% if event.maxAttendees > event.participantCount %}
    {% if app.session.get('participation_status') %}
      <form action="{{ path('event_unparticipate', {'id': event.id}) }}" method="post">
        {{ form_start(form) }}
        {{ form_widget(form._token) }}
        <button type="submit" class="button rounded-0 primary-bg text-white w-100 btn_1">
          Not Coming
        </button>
        {{ form_end(form) }}
      </form>
    {% else %}
      <form action="{{ path('event_participate', {'id': event.id}) }}" method="post">
        {{ form_start(form) }}
        {{ form_widget(form._token) }}
        <button type="submit" class="button rounded-0 primary-bg text-white w-100 btn_1">
          Participate
        </button>
        {{ form_end(form) }}
      </form>

    {% endif %}
  {% else %}
    <div >
      <form action="{{ path('event_unparticipate', {'id': event.id}) }}" method="post">
        {{ form_start(form) }}
        {{ form_widget(form._token) }}
        <button type="submit" class="button rounded-0 primary-bg text-white w-100 btn_1">
          Not Coming
        </button>
        {{ form_end(form) }}
      </form>
            <p class="max-capacity">This event has reached its maximum capacity.</p>

    </div>
  {% endif %}
{% else %}
  <p>Please <a href="{{ path('app_login') }}">log in</a> to participate in this event.</p>
{% endif %}


<form action="{{ path('event_rate', {'eventId': event.id}) }}" method="post" id="rating-form">
    {{ form_start(form) }}
    {{ form_widget(form._token) }}
    <div class="rating">
        {% set rating = ratingValue is defined ? ratingValue : null %}
        {% for i in 5..1 %}
            <input type="radio" id="star{{ i }}" name="rating" value="{{ i }}" {% if rating is not null and i == rating %}checked{% endif %}>
            <label for="star{{ i }}" class="star" onclick="submitRating({{ i }})"></label>
        {% endfor %}
    </div>
    {{ form_end(form) }}
</form>

<script>
  function submitRating(rating) {
    document.getElementById('rating-form').elements['rating'].value = rating;
    document.getElementById('rating-form').submit();
  }
</script>
                  </aside>
                  
<style>

 .rating input[type="radio"] {
    display: none;
  }

  .rating label:before {
    content: "\f005";
    font-family: "Font Awesome 5 Free";
    font-weight: 800;
    padding: 10px;
    font-size: 30px;
    color: #ccc;
    transition: all .2s;
    display: inline-block;
  }

  .rating input[type="radio"]:checked ~ label:before {
    color: #ffc700;
    content: "\f006";
  }

  .rating input[type="radio"]:checked ~ label:before ~ label:before:before {
    content: "\f007";
  }

  .rating input[type="radio"]:checked ~ label:before ~ label:before ~ label:before:before {
    content: "\f006";
  }

  .rating input[type="radio"]:checked ~ label:before ~ label:before ~ label:before ~ label:before:before {
    content: "\f009";
  }

  .rating input[type="radio"]:checked ~ label:before ~ label:before ~ label:before ~ label:before ~ label:before:before {
    content: "\f00a";
  }

p.max-capacity {

  background-color: #f8d7da;
  border: 1px solid #f5c6cb;
  color: #721c24;
  padding: 10px;
margin-top:5px;
  text-align: center;
  border-radius: 5px;
}

</style>


                  <aside class="single_sidebar_widget popular_post_widget">
                     <h3 class="widget_title">Recent Events</h3>
                     <div class="media post_item">
                        <img src="img/post/post_1.png" alt="post">
                        <div class="media-body">
                           <a href="single-blog.html">
                              <h3>{{event.name}}</h3>
                           </a>
                           <p> {{ event.startDate|date('Y-m-d H:i') }}</p>
                        </div>
                     </div>
                   
                     
    
                  </aside>
                 
                 
                 

               </div>
            </div>
         </div>
      </div>
   </section>




   <footer class="footer_part">
      <div class="container">
         <div class="row justify-content-around">
            <div class="col-sm-6 col-lg-2">
               <div class="single_footer_part">
                  <h4>Top Products</h4>
                  <ul class="list-unstyled">
                     <li><a href="">Managed Website</a></li>
                     <li><a href="">Manage Reputation</a></li>
                     <li><a href="">Power Tools</a></li>
                     <li><a href="">Marketing Service</a></li>
                  </ul>
               </div>
            </div>
            <div class="col-sm-6 col-lg-2">
               <div class="single_footer_part">
                  <h4>Quick Links</h4>
                  <ul class="list-unstyled">
                     <li><a href="">Jobs</a></li>
                     <li><a href="">Brand Assets</a></li>
                     <li><a href="">Investor Relations</a></li>
                     <li><a href="">Terms of Service</a></li>
                  </ul>
               </div>
            </div>
            <div class="col-sm-6 col-lg-2">
               <div class="single_footer_part">
                  <h4>Features</h4>
                  <ul class="list-unstyled">
                     <li><a href="">Jobs</a></li>
                     <li><a href="">Brand Assets</a></li>
                     <li><a href="">Investor Relations</a></li>
                     <li><a href="">Terms of Service</a></li>
                  </ul>
               </div>
            </div>
            <div class="col-sm-6 col-lg-2">
               <div class="single_footer_part">
                  <h4>Resources</h4>
                  <ul class="list-unstyled">
                     <li><a href="">Guides</a></li>
                     <li><a href="">Research</a></li>
                     <li><a href="">Experts</a></li>
                     <li><a href="">Agencies</a></li>
                  </ul>
               </div>
            </div>
            <div class="col-sm-6 col-lg-4">
               <div class="single_footer_part">
                  <h4>Newsletter</h4>
                  <p>Heaven fruitful doesn't over lesser in days. Appear creeping
                  </p>
                  <div id="mc_embed_signup">
                     <form target="_blank"
                        action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                        method="get" class="subscribe_form relative mail_part">
                        <input type="email" name="email" id="newsletter-form-email" placeholder="Email Address"
                           class="placeholder hide-on-focus" onfocus="this.placeholder = ''"
                           onblur="this.placeholder = ' Email Address '">
                        <button type="submit" name="submit" id="newsletter-submit"
                           class="email_icon newsletter-submit button-contactForm">subscribe</button>
                        <div class="mt-10 info"></div>
                     </form>
                  </div>
               </div>
            </div>
         </div>

      </div>
      <div class="copyright_part">
         <div class="container">
            <div class="row">
               <div class="col-lg-8">
                  <div class="copyright_text">
                     <P><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved | This template is made with <i class="ti-heart" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a>
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. --></P>
                  </div>
               </div>
               <div class="col-lg-4">
                  <div class="footer_icon social_icon">
                     <ul class="list-unstyled">
                        <li><a href="#" class="single_social_icon"><i class="fab fa-facebook-f"></i></a></li>
                        <li><a href="#" class="single_social_icon"><i class="fab fa-twitter"></i></a></li>
                        <li><a href="#" class="single_social_icon"><i class="fas fa-globe"></i></a></li>
                        <li><a href="#" class="single_social_icon"><i class="fab fa-behance"></i></a></li>
                     </ul>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </footer>

{% endblock %}
